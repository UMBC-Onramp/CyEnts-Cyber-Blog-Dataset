By Cedric Cochin and Steve Povolny on Aug 14, 2018 A locked Windows 10 device with Cortana enabled on the lock screen allows an attacker with physical access to the device to do two kinds of unauthorized browsing.

In the first case, the attacker can force Microsoft Edge to navigate to an attacker-controlled URL; in the second, the attacker can use a limited version of Internet Explorer 11 using the saved credentials of the victim.

In June we published our analysis of a full login bypass mechanism for all Windows 10 devices for which Cortana is enabled on the lock screen.

(This is still the default option.)

The discovery of the full login bypass was part of a wider research effort into what access the digital assistant Cortana might offer to an adversary when the device is locked.

This post details these two additional issues; we reported them to Microsoft at the same time we reported the login bypass.

The two new flaws have now been addressed as part of Microsoft’s August update.

Some of the issues are also partially mitigated by modifying the answer obtained from a Bing search query.

In the first scenario, a Cortana privilege escalation leads to forced navigation on a lock screen.

The vulnerability does not allow an attacker to unlock the device, but it does allow someone with physical access to force Edge to navigate to a page of the attacker’s choosing while the device is still locked.

This is not a case of BadUSB, man in the middle, or rogue Wi-Fi, just simple voice commands and interacting with the device’s touchscreen or mouse.

Several months ago, researchers from Israel demonstrated a similar attack using a BadUSB device, masquerading as a network interface card to inject content into trusted HTTP sites while using Cortana to force navigation.

Microsoft has since removed this ability to navigate directly to a domain and instead now opens a search in Bing over HTTPS to the domain in question.

Some of our findings could also be combined with a BadUSB approach.

We explored whether one could still force navigation to an attacker-controlled page.

In short, yes, one can, but it does take some extra effort.

Cortana is very helpful when it comes to defining terms, or looking up corporations, movies, artists, or athletes.

She can even do math.

However, Cortana’s behavior and the answers she gives are affected by the way you ask a question.

For example, if you were to ask the colloquial question “ Hey Cortana, what is McAfee? ”

you would get a quick answer directly from a Bing search.

If, however, you asked only “ Hey Cortana, McAfee, ” you would receive a more detailed response, including links to various trusted sites.

These include Wikipedia, Twitter, Facebook, LinkedIn, and the “official website” (more later on this important link).

Cortana’s answers to similar but not identical queries about “McAfee.”

It is surprising that links are offered and clickable when the device is locked.

If you start your favorite network sniffer or man-in-the-middle proxy, you will see that the links are visited as soon as the user clicks on them, irrespective of the device’s locked status.

This means we can force navigation to a website (though not yet the one we want) when the device is locked.

However, we have seen that Cortana can be picky in how she offers results.

Bing must already know these results, and most links are known trusted sites.

That leaves us with the official website.

You might recognize this terminology: It is a common link presented by Wikipedia.

If you look at the bottom of a Wikipedia article, you will often find a link to an official website.

Could Cortana just use Wikipedia as a trusted source?

After a few delightful conversations with her, we can confirm that the official website for items she refers from Wikipedia is indeed the same as the Official Website link on Wikipedia.

There is no one-to-one correlation on Wikipedia’s official website for Cortana to display the corresponding link.

We assume there is some possible weighting of the domain name or logic in the Bing output that influences Cortana’s displayed links.

We can leverage this information to craft a fake Wikipedia entry, add enough content to get the review to succeed, add an official website link, and see what Cortana presents.

Wikipedia reviewers do a pretty good job of vetting content, but we also need Bing to become aware of the entry so that Cortana could offer the answer and the link.

Because of the time-dependent factor of the approach (and the ethical aspect of tampering with Wikipedia content in a malicious way), we decided to take a different path—although others could use this attack vector.

Instead of creating an entry in Wikipedia, making sure that Bing indexes it and that Cortana provides the official website link, we opted for an alternative.

We can instead hunt Wikipedia for unmaintained or dead official website links.

Fortunately for us, Wikipedia maintains a list of “dead links” and “permanent dead links.”

A search for “Xbox Linux” looks like this: To aid in our hunt, Wikipedia has a fairly robust search engine that accepts regular expressions.

With just a little bit of tinkering we come up with the following search: insource:/\\{official (website)?\\|https?\\:\\/\\/[^}]+\\.com\\/[^}]\\}\\}\\{\\{dead link/ This is neither an exhaustive list, nor the most efficient regular expression, but it does find some candidates without triggering the Wikipedia query timeout.

The next step is to write a script to parse the output, grab a list of domains, and check whether they are actually vacant.

Many of them are still registered but do not serve any content; others are live despite the “dead link” tag.

We end up with a list of domains, some more expensive than others, that are vacant.

What will Cortana display for each of these Wikipedia entries?

One after another, we ask.

Retrospectively, writing a text-to-speech script would have been faster.

Cortana answers surprisingly well to other digital speech synthesizers.

Many of the entries do not provide the official website link, but some do.

It is annoying that the way you ask the question interferes with the results.

Not only is the phrasing of the question important; the decision of whether to dictate a word or spell it out may change the answer.

To obtain the answer you want from Cortana, you may have to combine both approaches.

For example, we asked “Hey Cortana, what is Miss Aruba?”

We saw, while the device was locked, the following answer: The official website link points to “hxxp://www.missaruba.aw.”

A quick search shows the domain is still available.

In conclusion, we now have Wikipedia articles for which Cortana will display an official website link, and for which the domain is available for purchase.

After spending $11.99 for a cheaper domain, we own one.

Although it took some regular-expression authoring, some scripting, and buying a domain, this method was faster and more satisfying than waiting for Bing to publish and index a new Wikipedia entry.

After this setup, what can we accomplish?

We can ask Cortana (either via the interactive icon or vocal command “Hey Cortana”) to conduct a search while the device is locked.

When she replies, we can click on the official website link and observe as Edge retrieves the content while the device remains locked.

  To put a malicious spin on this unauthorized access, we have at least one straightforward option.

We could install the latest exploit kit on our newly acquired domain and infect any locked Windows 10 PC with Cortana enabled without ever logging in.

This attack could occur at a coffee shop, retailer, bank, or against targeted individuals.

This configuration is the default on Windows, and our research has shown that many users never disable Cortana from the lock screen.

Digital voice assistants can be useful, but they must also be considered an attack vector.

Although some may think this is a “noisy” vector, not applicable when stealth is required, you can employ techniques such as the DolphinAttack, which uses inaudible voice commands to close an air gap.

Or if you have physical access to the device, a $5 3.5mm-jack cable will do as well.

An inexpensive 3.5mm-jack cable for silent interaction.

How can we protect against this attack vector?

You can disable Cortana on your lock screen.

Microsoft should not allow navigation to untrusted websites until it receives permission from the authenticated user, confirming on login that the user wants to visit a site.

Self-service Internet Explorer from the Windows lock screen When we investigate a technology, we sometimes find that our initial findings are less substantial than what we learn after further investigation.

Our research into Cortana and this attack surface was no different.

What if one could surf the web freely with a full-fledged browser such as Internet Explorer 11, with access to cached credentials and autocomplete on a locked Windows 10 device?

All thanks to Cortana?

That could be much more impactful than browsing to just one URL.

That is possible with Cortana’s skills.

It makes sense that Cortana offers skills similar to those of Amazon’s Alexa or Google Assistant.

But it does not make sense to offer these skills directly from the lock screen when they are not yet configured.

One example is the “Real Estate Search” skill.

While conversing with Cortana to analyze the capabilities she could offer an attacker, we found that she occasionally offered to try skills, including Real Estate Search.

One easy trigger is to ask “Hey Cortana, I want to sell my house.”

This leads to the following screen: If we click “Real Estate Search,” we get a login screen.

Instead of logging in, let’s look at the other links offered by the interface.

In the current case, the “Privacy Policy” link seems interesting: Cortana’s skill login screen with a link to Privacy Policy.

Opening the link, we see a lengthy policy.

If we scroll to the bottom of the page, we discover a few social media icons: Privacy policy screen with links to social media sites.

These icons are indeed links, allowing us to reach Facebook or YouTube, and from there the rest of the Internet: Reaching Facebook from the lock screen of a Windows 10 system.

Let’s summarize.

You left for lunch with your new Windows Surface Book locked on your desk.

Cortana is on by default on your lock screen.

Your disk is encrypted.

What could go wrong?

Anybody who has physical access to your locked device can start browsing the web.

What if someone were to navigate to a work-unfriendly website from your device, or post inflammatory comments in a public forum that could be attributed to your device’s IP address?

A device-specific attribution would be bad, but could you use the same method to post or access something from a real person’s name or account?

We next investigated which browser is being used?

Is it a Cortana custom browser?

Is it a sandboxed Microsoft Edge?

It is actually a customized Internet Explorer 11 restricted engine running in the context of AuthHost.exe.

(We will publish another analysis on this limited “browser” because its properties and lack of security mechanisms could become handy for red teams.)

This is the Internet Explorer engine and not the full browser, though both JavaScript and cookies are enabled.

Worse, this incarnation shares the autocomplete and credentials saved in the context of the current user’s Internet Explorer session.

Thus in addition to posting a comment on a public forum from another user’s device while the device is locked, you can also impersonate the user thanks to its cached credentials.

One potential attack scenario arises if a corporation offers a mechanism to reset Windows credentials via a web server but does not require users to reenter the old password.

One could simply navigate to the reset link, input a new password, exit the limited navigator, and unlock the device with the newly set password, all from a locked computer.

We have explored a couple of attack scenarios and security issues in this post, and we will continue our investigation into Cortana and other digital assistants as an attack vector.

Your best mitigation at this point is to turn off Cortana on the lock screen.

Here is a good tutorial on how to do so.




