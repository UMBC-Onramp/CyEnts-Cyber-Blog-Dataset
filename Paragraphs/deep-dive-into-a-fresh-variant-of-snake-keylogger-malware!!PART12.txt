
1.
Keylogger Feature Figure 4.2 shows a code snippet of setting up the keylogger.
It calls API SetWindowsHookExA() to register a hook callback function( this.callback_ProcessKey()) to monitor low-level keyboard input events.
The first parameter is the hook type, where “13” indicates WH_KEYBOARD_LL.
After that, the callback function is called by the Windows system when the victim types, so it is able to handle and record the keystrokes into a global string variable.
It also records the foreground Window title to identify where the victim types by calling the APIs GetForegroundWindow() and GetWindowText ().
It also has a Timer (Timer0) that keeps sending the keylogger data to the attacker.
2.
 Screenshot
It is able to take screenshots of the victim’s device.
It has a Timer (Timer1), which captures the victim’s screenshots from time to time by calling API CopyFromScreen().
It saves the screenshot into a local Screenshot.png file in the system’s “MyDocuments” folder.
It also sends this picture file to the attacker.
3.
 System Clipboard It has two Timers.
One (Time2) is used to collect system clipboard data by calling Clipboard.
GetText() and save to a global variable.
The other (Time3) is used to send collected clipboard data to the attacker.
Figure 4.3 shows the Timer function used to obtain system clipboard data.
Every time it counts down it checks to see whether current clipboard data has been collected in the global variable main_cls.string_clipboard_data.