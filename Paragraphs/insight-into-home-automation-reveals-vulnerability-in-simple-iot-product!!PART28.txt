
Unfortunately, the ROP chain that calls system requires the use of write-what-where to handle extra instructions in one of the ROP gadgets.
This means that two packets are required to execute the exploit: one to write the parameter for system into memory, and a second to make the call to system.
Thus it is important that the first packet exits cleanly and does not crash the program.
One way to execute cleanly is to use three well-placed pipes (“|”) inside the payload to stop writing and exit TokenParser at the appropriate time.