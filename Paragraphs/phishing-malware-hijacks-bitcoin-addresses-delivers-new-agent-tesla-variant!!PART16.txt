
In addition to what I explained above, it also collects data from the system clipboard and the victim’s inputs (the keylogger).
It calls the API SetClipboardViewer() to register itself so it is able to receive notice once the clipboard data is changed.
It can then obtain and save clipboard data.
The attacker also enabled the keylogger feature in this variant.
It sets a hook on the Windows message WH_KEYBOARD_LL (13) by calling the API function SetWindowsHookEx(), so it can receive all keyboard messages when the victim types.
Both data collected from the clipboard and through victim’s inputs are saved in html format in a global variable.
Agent Tesla starts a Timer (being called every 20 minutes) to check if the global variable has data, and if so, it sends its data to the attacker with the magic flag “KL_”.
As shown in Figure 5.4 is an example of the data collected from victim’s inputs and the clipboard that were extracted by me when it was sent to the attacker.
As you can see, this data contains basic information, including current time, User Name, Computer Name, OS version, CPU type, and memory capacity.
The keylogger data contains application name (“Google Chrome”), application title (“New Tab – Google Chrome”), current time (05/21/2021 10:48:18), as well as victim’s inputs at the second line.
The clipboard data starts with a constant string “Copied Text:” and clipboard data at the second line.
Sending Stolen Data to the Attacker Agent Tesla supports several ways to send stolen data to its C2 server.
They are over SMTP to send data to the attacker’s email address, over FTP to send the data to the attacker’s FTP server, and over HTTP POST to send the data to attacker’s HTTP server.