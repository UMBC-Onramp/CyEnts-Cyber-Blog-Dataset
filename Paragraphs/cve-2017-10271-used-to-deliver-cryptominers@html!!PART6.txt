
Limiting CPU usage to avoid suspicion Figure 9: Limiting CPU Usage To avoid suspicion, some attackers are limiting the CPU usage of the miner (Figure 9).
Tactic #3: Lateral movement across Windows environments using Mimikatz and EternalBlue
Some tactics involve spreading laterally across a victimâ€™s environment using dumped Windows credentials and the EternalBlue vulnerability ( CVE-2017-0144 ).
The malware checks whether its running on a 32-bit or 64-bit system to determine which PowerShell script to grab from the command and control (C2) server.
It looks at every network adapter, aggregating all destination IPs of established non-loopback network connections.
Every IP address is then tested with extracted credentials and a credential-based execution of PowerShell is attempted that downloads and executes the malware from the C2 server on the target machine.
This variant maintains persistence via WMI (Windows Management Instrumentation).
The malware also has the capability to perform a Pass-the-Hash attack with the NTLM information derived from Mimikatz in order to download and execute the malware in remote systems.
Additionally, the malware exfiltrates stolen credentials to the attacker via an HTTP GET request to: 'http://<C2>:8000/api.php?data=<credential data>'.
If the lateral movement with credentials fails, then the malware uses PingCastle MS17-010 scanner (PingCastle is a French Active Directory security tool) to scan that particular host to determine if its vulnerable to EternalBlue, and uses it to spread to that host.