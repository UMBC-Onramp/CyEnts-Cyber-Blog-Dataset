
After the code hook is added on line 4, the GetDeviceCaps hook completes and, prior to the execution of the sample's next instruction, the start_unpack_func_hook function is called.
This function is shown in Figure 11.
1: def start_unpack_func_hook(self, emu, addr, size, ctx): 2:     self.h_code_hook.disable() 3:     unpack_func_va = self.module.get_rva_from_offset(self.unpack_offs) + self.module.get_base() 4:     self.set_pc(unpack_func_va) Figure 11:
Code hook that changes the instruction pointer The code hook receives the emulator object, the address and size of the current instruction, and the context dictionary (line 1).