
I knew I could stub out a few function calls in the malware to run all of the relevant logic in Bochs.
Hereâ€™s how I did it.
Code Carving I needed opcodes for a few common functions to inject into my IDBs and emulate in Bochs.
I built simple C implementations of selected functions and compiled them into one binary.
Figure 2 shows some of these stand-ins.
Figure 2: Simple implementations of common functions I compiled this and then used IDAPython code similar to Figure 3 to extract the function opcode bytes.
Figure 3: Function extraction I curated a library of function opcodes in an IDAPython script as shown in Figure 4.