
I was greeted with the warning in Figure 10 indicating that the patched IDB would not match the depictions made by the debugger (which is untrue in the case of Bochs IDB mode).
Bochs faithfully executed my injected opcodes producing exactly the desired result.
Figure 10:
Patch warning I watched carefully as the instruction pointer approached and passed the IsDebuggerPresent check.
Because of the stub I injected ( stub_IsDebuggerPresent ), it passed the check returning zero as shown in Figure 11.
Figure 11:
Passing up IsDebuggerPresent I allowed the program counter to advance to address 0x1A1538 , just beyond the unpacking routine.
Figure 12 shows the register state at this point which reflects a value in EAX that was handed out by my fake heap allocator and which I was about to visit.